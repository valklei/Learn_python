Создать коллекцию users и заполнить документами (4 штуки) со следующими свойствами (id, name, age, gender). Используйте следующие данные:
	
1 Анатолий 28 m  
2 Светлана 25 f  
3 Никита 33 m  
4 Ольга 22 f  

---

use ich_edit

не обязательно: 
db.createCollection("users")

```javascript
db.users.insertMany([
  { "id": 1, "name": "Анатолий", "age": 28, "gender": "m" },
  { "id": 2, "name": "Светлана", "age": 25, "gender": "f" },
  { "id": 3, "name": "Никита", "age": 33, "gender": "m" },
  { "id": 4, "name": "Ольга", "age": 22, "gender": "f" }
])

```

--------------------------------------------------------------


### Удаление одного документа:
```javascript
db.users.deleteOne({ "id": 1 })
```
Это удалит первый документ, где `id` равно 1.

### Удаление всех документов, которые соответствуют условию:
```javascript
db.users.deleteMany({ "gender": "f" })
```
Это удалит все документы, где поле `gender` равно `"f"`.

Если вы хотите удалить все документы в коллекции, можете использовать:
```javascript
db.users.deleteMany({})
```


--------------------------------------------------------------


### Обновление одного документа:
```javascript
db.users_160924.updateOne(
  { "id": 1 },  // Условие поиска документа
  { $set: { "age": 29, "status": "active" } }  // Обновление поля "age"
)
```


### Обновление нескольких документов:
```javascript
db.users_160924.updateMany(
  { "gender": "m" },
  { $set: { "status": "active" } }  // Обновление/добавление поля "status"
)
```

```javascript
db.users_160924.updateMany(
  { "gender": "m" }, 
  { $unset: { "status": "" } }  // Удаление поля "status"
)
```
- Второй параметр `{ "status": "" }` указывает, что поле `status` должно быть удалено. Значение не имеет значения, важно только указать имя поля.

--------------------------------------------------------------


Оператор `$inc` используется для увеличения или уменьшения значения поля на указанную величину.

### Пример использования `$inc`:

#### Увеличение значения поля:
```javascript
db.users_160924.updateMany(
  { "gender": "m" },  // Условие поиска документа
  { $inc: { "age": 1 } }  // Увеличение значения поля "age" на 1
)
```

#### Уменьшение значения поля:
```javascript
db.users_160924.updateMany(
  { "gender": "m" },  // Условие поиска документа
  { $inc: { "age": -1 } }  // Уменьшение значения поля "age" на 1
)
```

#### Увеличение или уменьшение нескольких полей:
```javascript
db.users_160924.updateMany(
  {},  // Условие поиска
  { $inc: { "age": 2, "salary": 5000 } }  // Увеличение поля "age" на 2 и "salary" на 5000
)
```


### Примечания:
- `$inc` работает только с числовыми значениями. Попытка увеличить или уменьшить нечисловое поле вызовет ошибку.
- Если поле не существует, MongoDB создаст его с указанным значением для инкремента.

#### Только существующее поле:
```javascript
db.users_160924.updateMany(
  { "id": 2, "salary": { $exists: true } }, 
  { $inc: { "age": 1, "salary": 5000 } }
)
```




------------------------------------------------------
------------------------------------------------------
------------------------------------------------------


## **Общее объяснение структуры `$group`**
```javascript
{
  _id: expression,  // Уникальный идентификатор группы
  fieldN: {         // Имя поля в выходном документе
    accumulatorN: expressionN  // Агрегирующая функция (например, $sum, $avg)
  }
}
```

| Компонент          | Описание                                                                  |
|--------------------|---------------------------------------------------------------------------|
| **`_id`**          | Поле, по которому происходит группировка (`"$year"`, `"$genres"`, `null`) |
| **`fieldN`**       | Название нового поля, в котором сохраняется агрегированное значение       |
| **`accumulatorN`** | Функция агрегации (`$sum`, `$avg`, `$max`, `$min`, `$first`, `$last`)     |
| **`expressionN`**  | Поле или выражение, которое передаётся в функцию агрегации                |


## **Примеры**

### **Пример 1: Подсчитать количество фильмов по жанрам**  
```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: "$genres",       // Группируем по жанру
      total_movies: { $sum: 1 }  // Считаем количество фильмов в каждом жанре
    }
  }
])
```

---

### **Пример 2: Найти средний IMDb рейтинг по годам**  
```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: "$year",                 // Группируем по году
      average_rating: { $avg: "$imdb.rating" }  // Вычисляем средний рейтинг за год
    }
  }
])
```

---

### **Пример 3: Найти самый длинный фильм по каждому жанру**  
```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: "$genres",         // Группируем по жанру
      longest_runtime: { $max: "$runtime" }  // Находим максимальную продолжительность фильма
    }
  }
])
```

---

### **Пример 4: Найти первый фильм каждого жанра (по году)**
```javascript
db.imdb.aggregate([
  { $sort: { year: 1 } },  // Сортируем по году (от раннего к позднему)
  {
    $group: {
      _id: "$genres",      
      first_movie: { $first: "$title" }  // Берём первый фильм каждого жанра
    }
  }
])
```


---

| Функция       | Описание                    | Пример использования                                        |
|---------------|-----------------------------|-------------------------------------------------------------|
| **`$sum`**    | Считает сумму               |  `total_runtime: { $sum: "$runtime" }`                      |
| **`$avg`**    | Среднее значение            | `average_rating: { $avg: "$imdb.rating" }`                  |
| **`$max`**    | Максимальное значение       | `max_rating: { $max: "$imdb.rating" }`                      |
| **`$min`**    | Минимальное значение        | `earliest_year: { $min: "$year" }`                          |
| **`$round`**  | Округляет число             | `average_rating: { $round: [{ $avg: "$imdb.rating" }, 1] }` |
| **`$first`**  | Первый документ в группе    | `first_movie: { $first: "$title" }`                         |
| **`$last`**   | Последний документ в группе | `last_movie: { $last: "$title" }`                           |

### **Примеры**  

## **1. `$sum`** – суммирует значения указанного поля  
✅ **Пример:** Найти **общее количество минут всех фильмов**  

```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: null,
      total_runtime: { $sum: "$runtime" }
    }
  }
])
```

---

## **2. `$avg`** – вычисляет среднее значение  
✅ **Пример:** Найти **средний рейтинг IMDb всех фильмов**  

```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: null,
      average_rating: { $avg: "$imdb.rating" }
    }
  }
])
```


---

## **3. `$max`** – находит максимальное значение  
✅ **Пример:** Найти **максимальный IMDb рейтинг среди всех фильмов**  

```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: null,
      max_rating: { $max: "$imdb.rating" }
    }
  }
])
```

---

## **4. `$min`** – находит минимальное значение  
✅ **Пример:** Найти **самый ранний год выпуска фильма**  

```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: null,
      earliest_year: { $min: "$year" }
    }
  }
])
```

---

## **5. `$round`** – округляет число  
✅ **Пример:** Найти **средний IMDb рейтинг фильмов и округлить до 1 знака после запятой**  

```javascript
db.imdb.aggregate([
  {
    $group: {
      _id: null,
      average_rating: { $avg: "$imdb.rating" }  // Считаем среднее значение
    }
  },
  {
    $project: {
      _id: 0,
      average_rating: { $round: ["$average_rating", 1] } // Округляем во втором этапе
    }
  }
])

```

---

## **6. `$first`** – выбирает **первый документ** из сгруппированных данных  
✅ **Пример:** Найти **первый фильм по каждому жанру**  

```javascript
db.imdb.aggregate([
  { $sort: { year: 1 } },  // Сортируем по возрастанию года
  {
    $group: {
      _id: "$genres",
      first_movie: { $first: "$title" }
    }
  }
])
```

---

## **7. `$last`** – выбирает **последний документ** из сгруппированных данных  
✅ **Пример:** Найти **последний фильм по каждому жанру**  

```javascript
db.imdb.aggregate([
  { $sort: { year: 1 } },  // Сортируем по возрастанию года
  {
    $group: {
      _id: "$genres",
      last_movie: { $last: "$title" }
    }
  }
])
```

